// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import "forge-std/Script.sol";
import "../src/Instance.sol";

/**
 * @title HelloEthernautExploit
 * @notice Ethernaut Level 0: Hello Ethernaut
 * @dev This is a tutorial level. The goal is to understand the interface
 * and learn how to interact with contracts. The password is "ethernaut0".
 * 
 * Steps:
 * 1. Call info() -> points to info1()
 * 2. Call info1() -> points to info2("hello")
 * 3. Call info2("hello") -> reveals infoNum = 42
 * 4. Call info42() -> reveals theMethodName = "method7123949"
 * 5. Call method7123949() -> tells us to submit password
 * 6. Call authenticate("ethernaut0") -> completes the level
 * 
 * Usage:
 * 1. Set INSTANCE_ADDRESS in this script to your deployed instance
 * 2. Set SEPOLIA_RPC and PRIVATE_KEY in .env file
 * 3. Run: forge script script/HelloEthernautExploit.s.sol:HelloEthernautExploit \\
 *      --rpc-url $SEPOLIA_RPC --private-key $PRIVATE_KEY --broadcast -vvvv
 */
contract HelloEthernautExploit is Script {
    
    // Replace this with your instance address from Ethernaut UI
    // Get it from: https://ethernaut.openzeppelin.com/level/0
    address constant INSTANCE_ADDRESS = address(0x0); // TODO: Set your instance address
    
    function run() external {
        require(INSTANCE_ADDRESS != address(0), "ERROR: Set INSTANCE_ADDRESS to your deployed instance!");
        
        uint256 deployerPrivateKey = vm.envUint("PRIVATE_KEY");
        address deployer = vm.addr(deployerPrivateKey);
        
        console.log("============================================================");
        console.log("Ethernaut Level 0: Hello Ethernaut");
        console.log("============================================================");
        console.log("Player:", deployer);
        console.log("Instance:", INSTANCE_ADDRESS);
        console.log("");
        
        vm.startBroadcast(deployerPrivateKey);
        
        Instance instance = Instance(INSTANCE_ADDRESS);
        
        // Step 1-5: Follow the clues to discover the password
        console.log("Step 1: Calling info()...");
        string memory info = instance.info();
        console.log("  info():", info);
        
        console.log("Step 2: Calling info1()...");
        string memory info1 = instance.info1();
        console.log("  info1():", info1);
        
        console.log("Step 3: Calling info2('hello')...");
        string memory info2 = instance.info2("hello");
        console.log("  info2('hello'):", info2);
        
        console.log("Step 4: Calling info42()...");
        string memory info42 = instance.info42();
        console.log("  info42():", info42);
        
        console.log("Step 5: Calling method7123949()...");
        string memory methodResult = instance.method7123949();
        console.log("  method7123949():", methodResult);
        
        // The password is revealed in the contract source: "ethernaut0"
        string memory password = "ethernaut0";
        console.log("");
        console.log("Discovered password:", password);
        
        // Step 6: Submit the password
        console.log("Step 6: Calling authenticate('ethernaut0')...");
        instance.authenticate(password);
        
        vm.stopBroadcast();
        
        // Verify success
        bool cleared = instance.getCleared();
        console.log("");
        console.log("============================================================");
        if (cleared) {
            console.log("SUCCESS! Level completed!");
        } else {
            console.log("FAILED! Level not cleared.");
        }
        console.log("getCleared():", cleared);
        console.log("============================================================");
    }
}
