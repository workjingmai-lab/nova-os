# Vulnerability Pattern Database

## Access Control

### AC-001: tx.origin Authentication
**Severity:** High  
**Pattern:** Using `tx.origin` for authentication  
**Impact:** Phishing attacks, ownership theft  
**Detection:** `grep -r "tx.origin" contracts/`  
**Fix:** Use `msg.sender`

### AC-002: Missing Authorization
**Severity:** Critical  
**Pattern:** Admin functions without modifiers  
**Impact:** Anyone can call privileged functions  
**Detection:** Check all external functions  
**Fix:** Add `onlyOwner` or role-based checks

### AC-003: Constructor Typos
**Severity:** Critical  
**Pattern:** Constructor name doesn't match contract  
**Impact:** Anyone can call "constructor" as regular function  
**Detection:** `function ContractName()` vs `constructor()`  
**Fix:** Use `constructor()` syntax

### AC-004: Unprotected Selfdestruct
**Severity:** Critical  
**Pattern:** Anyone can call `selfdestruct`  
**Impact:** Contract destruction, fund loss  
**Detection:** Check all `selfdestruct` calls  
**Fix:** Add access control

### AC-005: Delegatecall Ownership
**Severity:** Critical  
**Pattern:** Unprotected `delegatecall`  
**Impact:** Complete contract takeover  
**Detection:** Check `delegatecall` usage  
**Fix:** Validate target, restrict callers

## Reentrancy

### RE-001: Single-Function Reentrancy
**Severity:** Critical  
**Pattern:** External call before state update  
**Impact:** Fund drain, state corruption  
**Code Pattern:**
```solidity
// VULNERABLE
external.call{value: x}("");  // External call
balances[user] -= x;         // State update after

// SAFE
balances[user] -= x;         // State update first
external.call{value: x}("");  // External call after
```
**Fix:** Checks-Effects-Interactions pattern

### RE-002: Cross-Function Reentrancy
**Severity:** High  
**Pattern:** Reentrancy across multiple functions  
**Impact:** Complex state manipulation  
**Detection:** Shared state across functions with external calls  
**Fix:** ReentrancyGuard on all related functions

### RE-003: Read-Only Reentrancy
**Severity:** Medium  
**Pattern:** View functions affected by reentrancy  
**Impact:** Oracle manipulation, incorrect pricing  
**Detection:** View functions that read state changed during reentrancy  
**Fix:** Locks or state consistency checks

## Oracle Manipulation

### OR-001: Single Oracle Dependency
**Severity:** High  
**Pattern:** Only one price source  
**Impact:** Price manipulation attacks  
**Detection:** Check oracle usage  
**Fix:** Multiple oracle sources, TWAP

### OR-002: Stale Price Usage
**Severity:** High  
**Pattern:** Using old oracle data  
**Impact:** Incorrect pricing, arbitrage  
**Detection:** Check timestamp validation  
**Fix:** Validate freshness, use staleness thresholds

### OR-003: Spot Price Manipulation
**Severity:** Critical  
**Pattern:** Using spot price from DEX  
**Impact:** Flash loan attacks  
**Detection:** `getReserves()`, `balanceOf()` for pricing  
**Fix:** TWAP, oracle aggregators

## Integer Math

### IM-001: Integer Overflow
**Severity:** Critical (pre-0.8.0)  
**Pattern:** No overflow protection  
**Impact:** Balance manipulation, logic errors  
**Detection:** Solidity < 0.8.0 without SafeMath  
**Fix:** Use 0.8.0+ or SafeMath

### IM-002: Precision Loss
**Severity:** Medium  
**Pattern:** Division before multiplication  
**Impact:** Rounding errors, fund loss  
**Code Pattern:**
```solidity
// VULNERABLE
return (a / b) * c;

// SAFE
return (a * c) / b;
```

### IM-003: Zero Division
**Severity:** Medium  
**Pattern:** No check for zero divisor  
**Impact:** Transaction revert, DOS  
**Detection:** All division operations  
**Fix:** Check divisor != 0

## Storage

### ST-001: Private Variable Exposure
**Severity:** Low (impact varies)  
**Pattern:** Storing secrets on-chain  
**Impact:** Secrets revealed  
**Detection:** `private` variables with sensitive data  
**Fix:** Don't store secrets on-chain

### ST-002: Storage Collision (Proxy)
**Severity:** Critical  
**Pattern:** Proxy and implementation share slots  
**Impact:** Storage corruption  
**Detection:** Upgradeable contracts  
**Fix:** Proper storage layout, EIP-1967

### ST-003: Array Underflow
**Severity:** Critical  
**Pattern:** Decrementing empty array length  
**Impact:** Array spans all storage  
**Code Pattern:** `array.length--` on empty array  
**Fix:** Check length > 0, use SafeMath

## Economic

### EC-001: Flash Loan Attacks
**Severity:** Critical  
**Pattern:** Price manipulation via flash loans  
**Impact:** Arbitrage, fund drain  
**Detection:** Single-block price changes  
**Fix:** TWAP, flash loan detection

### EC-002: Sandwich Attacks
**Severity:** Medium  
**Pattern:** MEV extraction on DEX trades  
**Impact:** User losses to MEV bots  
**Detection:** Large trades with slippage  
**Fix:** Slippage protection, private mempool

### EC-003: Griefing
**Severity:** Medium  
**Pattern:** Forcing gas consumption  
**Impact:** DOS, failed transactions  
**Detection:** External calls without gas limits  
**Fix:** Gas limits, pull over push

## Logic

### LG-001: Race Conditions
**Severity:** Medium  
**Pattern:** Time-sensitive operations  
**Impact:** MEV exploitation  
**Detection:** Block.timestamp dependency  
**Fix:** Time windows, commit-reveal

### LG-002: Input Validation
**Severity:** Medium  
**Pattern:** Missing parameter checks  
**Impact:** Unexpected behavior  
**Detection:** External function parameters  
**Fix:** Comprehensive validation

### LG-003: Invariant Violations
**Severity:** High  
**Pattern:** Breaking economic guarantees  
**Impact:** Fund loss, system collapse  
**Detection:** Check core invariants  
**Fix:** Invariant checks, circuit breakers

## External Calls

### EX-001: Unchecked Return Values
**Severity:** Medium  
**Pattern:** Ignoring call return values  
**Impact:** Silent failures  
**Code Pattern:** `call{value: x}("");` without check  
**Fix:** `require(success, "message")`

### EX-002: Gas Limit DoS
**Severity:** Medium  
**Pattern:** Unbounded loops in external calls  
**Impact:** Block gas limit hit  
**Detection:** Dynamic-length iterations  
**Fix:** Pagination, pull over push

### EX-003: Forced Ether (selfdestruct)
**Severity:** Low (usually)  
**Pattern:** Contract can't prevent ETH receipt  
**Impact:** Unexpected balance  
**Detection:** Balance-dependent logic  
**Fix:** Don't rely on `address(this).balance`

## Quick Reference Table

| Severity | Response Time | Priority |
|----------|--------------|----------|
| Critical | Immediate | P0 |
| High | Same day | P1 |
| Medium | Within week | P2 |
| Low | Nice to have | P3 |

---

*Pattern recognition = faster audits = more findings = more earnings.* ðŸŽ¯
