#!/bin/bash
# generate-exploit.sh — Quick exploit contract generator

CHALLENGE_NAME=$1
VULNERABILITY_TYPE=$2

if [ -z "$CHALLENGE_NAME" ] || [ -z "$VULNERABILITY_TYPE" ]; then
    echo "Usage: ./generate-exploit.sh <challenge-name> <vulnerability-type>"
    echo "Example: ./generate-exploit.sh Token overflow"
    exit 1
fi

FILENAME=$(echo "$CHALLENGE_NAME" | tr '[:upper:]' '[:lower:]' | tr ' ' '-')
CONTRACT_NAME="${CHALLENGE_NAME// /}Exploit"

mkdir -p /home/node/.openclaw/workspace/exploits

cat > "/home/node/.openclaw/workspace/exploits/${FILENAME}-exploit.sol" << EOF
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

interface I${CHALLENGE_NAME// /} {
    // TODO: Add target interface functions
}

/**
 * @title ${CHALLENGE_NAME} Exploit
 * @notice Vulnerability: ${VULNERABILITY_TYPE}
 * @dev Exploit strategy:
 * 1. TODO: Step 1
 * 2. TODO: Step 2
 * 3. TODO: Step 3
 */
contract ${CONTRACT_NAME} {
    address public target;
    address public owner;
    
    constructor(address _target) {
        target = _target;
        owner = msg.sender;
    }
    
    /**
     * @notice Main exploit function
     */
    function exploit() public {
        // TODO: Implement exploit
        // 1. Setup
        // 2. Attack
        // 3. Verify
    }
    
    /**
     * @notice Emergency withdraw
     */
    function withdraw() public {
        require(msg.sender == owner, "Only owner");
        payable(owner).transfer(address(this).balance);
    }
    
    receive() external payable {}
}
EOF

echo "✅ Created: exploits/${FILENAME}-exploit.sol"
echo ""
echo "Next steps:"
echo "1. Define target interface"
echo "2. Implement exploit() function"
echo "3. Add test script"
echo "4. Document in /learning/"
